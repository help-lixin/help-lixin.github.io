---
layout: post
title: 'MyCat与Sharding JDBC选型问题'
date: 2021-06-30
author: 李新
tags:  MyCat
---

### (1).  前言
```
面试官问: 你是用什么样的组件,进行分表分库?
我答: 用的是Shardin JDBC,并且,有看完它部份源码,因为:MyCat我不敢用.  

面试官问: 为什么不敢用MyCat?
我答: 
   1. MyCat的优点是分表分库对于开发来说比较透明.  
   2. MyCat存在单点的问题,若是所有的项目都依赖MyCat,只要MyCat出了故障,所有的项目都会出问题.  
   3. MyCat若是要解决单点故障,需要用VIP(Keepalived)来解决,并且,机器的成本稍微有点高(当初没说这一点,因为,被面试官打断了我的话题).  

面试官问: 你了解MyCAT针对以上问题有解决方案吗?
我答:  沉思中(因为,MyCat和Sharding JDBC选项问题,还是4年前的事情,确实,已经没有关注MyCat的最新情况了,所以,不敢乱说话).
```
### (2). 结论是什么呢?
> 回来后,我去看了下MyCat官网,MyCat根本就解决不了我说的那些问题.<font color='red'>我被"唬住"了,还是太善良了</font>.     
> 可能,面试官是想问针对MyCat的单点是怎么解决的?但,估计他没有耐心听我说下去,因为:我说话喜欢讲前因后果.      
> 分结步骤如下:  

```
1. 有2个MyCat(1核512M),用Keepalived实现了VIP飘移功能,同时,MyCat拥有10个分片(DB).  
2. 应用A,应用B,应用C...都共享着这一套MyCat.  
3. 前端用户发起一个请求,由应用程序A,调用MyCat去查询时,因为没有路由KEY,就会从10个分片(DB)中各获取:100W条数据出来,然后,在MyCat在内存中对这10 * 100W条数据排序.  
4. 由于MyCat的配置低,压根就撑不住(10*100W的数据排序),这个时候挂了,就会出现了VIP漂移.   
5. 然后,前端用户,看到没有反映,不停的按F5刷新页面,结果是:步骤3又走了一遍,又把刚VIP飘移的MyCat给弄死了.  
6. 在这个时候,应用A,应用B,应用C...都会受到影响.
7. 这也是4年前,做调研时,不选择MyCat的主要原因,次要原因是:MyCat对CPU和内存的要求都高,成本太高了.     
```
