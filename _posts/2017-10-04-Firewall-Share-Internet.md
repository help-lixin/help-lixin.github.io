---
layout: post
title: 'Centos 7 运用Firewall上网'
date: 2017-10-04
author: 李新
tags: Linux
---

### (1). 前言
> 在生产上,一般只有堡垒机和Nginx服务器有外网IP,其余机器,有时有需要上网:比如yum安装软件.
> 在这样的情况下,可以通过如下方式进行上网.  

### (2). 机器准备

|  机器名称   | 内网IP        | 公网IP        |
|  ----      | ----         |   ----        |
|  tomcat-1  | 172.18.79.99 | 47.119.194.54 |
|  tomcat-2  | 172.18.79.100|               |

### (3). tomcat-1配置
```
#1. 开启防火墙并加入开机自启动
[root@tomcat-1 ~]# systemctl enable firewalld.service
[root@tomcat-1 ~]# systemctl restart firewalld.service

# 2. 添加只允许172.18.79.100这台主机访问
[root@tomcat-1 ~]# firewall-cmd --add-rich-rule='rule family=ipv4 source address=172.18.79.100/20 service name=ssh accept' --permanent

# 3. 开启ip伪装,为后续主机提供共享上网【管理机】
[root@tomcat-1 ~]# firewall-cmd --add-masquerade  --permanent

# 4. 重启生效
[root@tomcat-1 ~]# firewall-cmd --reload
```
### (4). tomcat-2配置
```
# 1. 没有公网IP,自然无法上网
[root@tomcat-2 ~]# ping www.baidu.com
PING www.a.shifen.com (14.215.177.38) 56(84) bytes of data.
--- www.a.shifen.com ping statistics ---
3 packets transmitted, 0 received, 100% packet loss, time 1999ms

# 2. 查看IP信息
[root@tomcat-2 ~]# ip addr
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 00:16:3e:16:65:ec brd ff:ff:ff:ff:ff:ff
    inet 172.18.79.100/20 brd 172.18.79.255 scope global dynamic eth0
       valid_lft 315359529sec preferred_lft 315359529sec
    inet6 fe80::216:3eff:fe16:65ec/64 scope link
       valid_lft forever preferred_lft forever

# 3. 配置网卡对应的网关和DNS
[root@tomcat-2 ~]# vi /etc/sysconfig/network-scripts/ifcfg-eth0
# Generated by parse-kickstart
DEVICE=eth0
IPV6INIT=yes
BOOTPROTO=none
UUID=4aedf84c-f65f-49f5-bc7f-75cad2fc4d7b
ONBOOT=yes
TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
NAME="System eth0"
IPADDR=172.18.79.100
PREFIX=20
GATEWAY=172.18.79.99
DNS1=100.100.2.136
DNS2=100.100.2.138

# 4. 重启网卡
[root@tomcat-2 ~]# ifdown eth0; ifup eth0
```
