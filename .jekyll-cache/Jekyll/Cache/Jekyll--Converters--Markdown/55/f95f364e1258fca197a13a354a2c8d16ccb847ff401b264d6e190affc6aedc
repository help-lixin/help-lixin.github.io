I"”<h3 id="1channelpipeline">(1).ChannelPipeline</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>è¯´ChannelPipelineæ—¶,ä¸å¾—ä¸è¯´ä¸‹ä»¥ä¸‹å‡ ä¸ªæ¥å£:
    io.netty.channel.ChannelPipeline 
    io.netty.channel.ChannelHandlerContext 
    io.netty.channel.ChannelHandler 
    io.netty.channel.Channel
</code></pre></div></div>

<h3 id="2channelpipeline-æ¥å£å£°æ˜">(2).ChannelPipeline æ¥å£å£°æ˜</h3>
<p><img src="/assets/netty/imgs/ChannelPipeline.png" alt="&quot;ChannelPipelineæ¥å£å£°æ˜&quot;" /></p>

<h3 id="3channelhandlercontextæ¥å£è¯¦è§£">(3).ChannelHandlerContextæ¥å£è¯¦è§£</h3>
<p><img src="/assets/netty/imgs/ChannelHandlerContext.png" alt="&quot;ChannelHandlerContextæ¥å£è¯¦è§£&quot;" /></p>

<h3 id="4channelhandleræ¥å£è¯¦è§£">(4).ChannelHandleræ¥å£è¯¦è§£</h3>
<p><img src="/assets/netty/imgs/ChannelHandler.png" alt="&quot;ChannelHandleræ¥å£è¯¦è§£&quot;" /></p>

<h3 id="5channelpipelineaddlastxxx-æµç¨‹å›¾è§£">(5).ChannelPipeline.addLast(xxx) æµç¨‹å›¾è§£</h3>
<p><img src="/assets/netty/imgs/ChannelPipeline-addLast.png" alt="&quot;ChannelPipeline.addLast(xxx) æµç¨‹å›¾è§£&quot;" /></p>

<h3 id="6channelpipelineaddlastxxx">(6).ChannelPipeline.addLast(xxx)</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public class DefaultChannelPipeline implements ChannelPipeline {
    private boolean registered;
    
    // æ·»åŠ ChanndlHandler
    public final ChannelPipeline addLast(ChannelHandler... handlers) {
        return addLast(null, handlers);
    } // end addLast
    
    public final ChannelPipeline addLast(EventExecutorGroup executor, ChannelHandler... handlers) {
        ObjectUtil.checkNotNull(handlers, "handlers");

        for (ChannelHandler h: handlers) {
            if (h == null) {
                break;
            }
            // addLast
            addLast(executor, null, h);
        }
        return this;
    } // end addLast
    
    public final ChannelPipeline addLast(EventExecutorGroup group, String name, ChannelHandler handler) {
        final AbstractChannelHandlerContext newCtx;
        synchronized (this) {
            // éªŒè¯
            checkMultiplicity(handler);

            // åˆ›å»º:DefaultChannelHandlerContext(åŒ…è£¹ç€channel/handler)
            newCtx = newContext(group, filterName(name, handler), handler);

            // å‘é“¾è¡¨çš„å°¾éƒ¨åŠ å…¥ä¸Šä¸‹æ–‡
            addLast0(newCtx);

            // !(false)
            if (!registered) { 
                // ä¸ºæ–°åˆ›å»ºçš„ä¸Šä¸‹æ–‡è®¾ç½®çŠ¶æ€ä¸º:ADD_PEDING
                newCtx.setAddPending();
                // 
                callHandlerCallbackLater(newCtx, true);
                // ç›´æ¥returnäº†
                return this;
            }

            EventExecutor executor = newCtx.executor();
            if (!executor.inEventLoop()) {
                callHandlerAddedInEventLoop(newCtx, executor);
                return this;
            }
        }
        callHandlerAdded0(newCtx);
        return this;
    } // end addLast
    
    
    private void callHandlerCallbackLater(AbstractChannelHandlerContext ctx, boolean added) {
        assert !registered;
        // added = true
        // åˆ›å»º:PendingHandlerAddedTask
        PendingHandlerCallback task = added ? new PendingHandlerAddedTask(ctx) : new PendingHandlerRemovedTask(ctx);
        PendingHandlerCallback pending = pendingHandlerCallbackHead;
        if (pending == null) {
            // è®¾ç½®å½“å‰å¯¹è±¡çš„å±æ€§:pendingHandlerCallbackHeadä¸º:PendingHandlerAddedTask
            pendingHandlerCallbackHead = task;
        } else {
            while (pending.next != null) {
                pending = pending.next;
            }
            pending.next = task;
        }
    }// end callHandlerCallbackLater
    
}
</code></pre></div></div>

<h3 id="7æ€»ç»“">(7).æ€»ç»“</h3>
<p>ChannelPipeline.addLast()æ–¹æ³•åœ¨æ‰§è¡Œæ—¶.</p>
<ol>
  <li>åˆ›å»ºDefaultChannelHandlerContextåŒ…è£¹ç€:ChannelHandler</li>
  <li>æŠŠDefaultChannelHandlerContextæ·»åŠ åˆ°é“¾è¡¨çš„æœ«ç«¯.</li>
  <li>è®¾ç½®DefaultChannelHandlerContextçŠ¶æ€ä¸º:ADD_PEDING</li>
  <li>åˆ›å»º:PendingHandlerAddedTaskä»»åŠ¡.</li>
</ol>
:ET