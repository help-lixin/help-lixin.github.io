I"‚&<h3 id="1æ¡ˆä¾‹">(1).æ¡ˆä¾‹</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Flux.just("1","2")
    .subscribe(c-&gt;{
            System.out.println("consumer:" + c);
    });
</code></pre></div></div>
<h3 id="2fluxsubscribe">(2).Flux.subscribe</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public final Disposable subscribe(Consumer&lt;? super T&gt; consumer) {
    // consumer = help.lixin.samples.Flux2Test$$Lambda$7
    Objects.requireNonNull(consumer, "consumer");
    return subscribe(consumer, null, null);
}
</code></pre></div></div>
<h3 id="3fluxsubscribe">(3).Flux.subscribe</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public final Disposable subscribe(
        @Nullable Consumer&lt;? super T&gt; consumer,
        @Nullable Consumer&lt;? super Throwable&gt; errorConsumer,
        @Nullable Runnable completeConsumer) {
           // consumer è®¢é˜…
           // errorConsumer é”™è¯¯å¤„ç†
           // completeConsumer å®Œæˆå¤„ç†
    return subscribe(consumer, errorConsumer, completeConsumer, (Context) null);
}
</code></pre></div></div>
<h3 id="4fluxsubscribe">(4).Flux.subscribe</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public final Disposable subscribe(
        @Nullable Consumer&lt;? super T&gt; consumer,
        @Nullable Consumer&lt;? super Throwable&gt; errorConsumer,
        @Nullable Runnable completeConsumer,
        // null
        @Nullable Context initialContext) {
    return subscribeWith(
        // åˆ›å»º:reactor.core.publisher.LambdaSubscriber
        // åŒ…è¯¾ç€æ­£ç¡®æ¶ˆè´¹è€…/é”™è¯¯æ¶ˆè´¹è€…/å®Œæˆå¤„ç†ç­‰...
        new LambdaSubscriber&lt;&gt;(consumer, errorConsumer,completeConsumer,null,initialContext)
    );
}
</code></pre></div></div>
<h3 id="5lambdasubscriber">(5).LambdaSubscriber</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>interface CoreSubscriber&lt;T&gt; extends Subscriber&lt;T&gt; {}

interface InnerConsumer&lt;I&gt;
          extends CoreSubscriber&lt;I&gt;, 
          Scannable {             
}

final class LambdaSubscriber&lt;T&gt;
		implements InnerConsumer&lt;T&gt;, 
             Disposable {      
}
// LambdaSubscriber å±äº:Subscriberçš„å®ç°ç±»
</code></pre></div></div>
<h3 id="6fluxsubscribewith">(6).Flux.subscribeWith</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public final &lt;E extends Subscriber&lt;? super T&gt;&gt; E subscribeWith(E subscriber) {
    // reactor.core.publisher.LambdaSubscriber
    // è°ƒç”¨æœ€ç»ˆçš„subscribe
    subscribe(subscriber);
    return subscriber;
}
</code></pre></div></div>
<h3 id="7fluxsubscribe">(7).Flux.subscribe</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public final void subscribe(Subscriber&lt;? super T&gt; actual) {
    // actual = reactor.core.publisher.LambdaSubscriber
    
    // ***************************************************
    // æŠŠFluxArrayè½¬æ¢æˆ:CorePublisher
    // this = FluxArray
    // ***************************************************
    CorePublisher publisher = Operators.onLastAssembly(this);
    
    // ***************************************************
    // æŠŠreactor.core.publisher.LambdaSubscriber
    // è½¬æ¢æˆ: CoreSubscriber
    // ***************************************************
    CoreSubscriber subscriber = Operators.toCoreSubscriber(actual);

    try {
        // ä»ä¸Šé¢çš„åˆ†æå¾—äº†:publisherä¸æ˜¯OptimizableOperatorçš„å­ç±»
        if (publisher instanceof OptimizableOperator) {  // false
            OptimizableOperator operator = (OptimizableOperator) publisher;
            while (true) {
                subscriber = operator.subscribeOrReturn(subscriber);
                if (subscriber == null) {
                    return;
                }
                
                OptimizableOperator newSource = operator.nextOptimizableSource();
                
                if (newSource == null) {
                    publisher = operator.source();
						break;
                } //end if
                
                operator = newSource;
            } //end while
        } //end if
        
        
        // ***************************************************
        // reactor.core.publisher.FluxArray
        //   .subscribe(reactor.core.publisher.LambdaSubscriber s)
        // ***************************************************
        publisher.subscribe(subscriber);
    } catch (Throwable e) {
        Operators.reportThrowInSubscribe(subscriber, e);
        return;
    }
}
</code></pre></div></div>
<h3 id="8fluxarraysubscribe">(8).FluxArray.subscribe</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public void subscribe(CoreSubscriber&lt;? super T&gt; actual) {
    // actual = reactor.core.publisher.LambdaSubscriber
    // array = ["1","2"]
    subscribe(actual, array);
}

public static &lt;T&gt; void subscribe(CoreSubscriber&lt;? super T&gt; s, T[] array) {
        // s = reactor.core.publisher.LambdaSubscriber
        // array = ["1","2"]
        if (array.length == 0) {  // false
            Operators.complete(s);
            return;
        }// end if
        
        if (s instanceof ConditionalSubscriber) { // false
            s.onSubscribe(new ArrayConditionalSubscription&lt;&gt;((ConditionalSubscriber&lt;? super T&gt;) s, array));
        } else {
            // *********************Subscriber.onSubscribe*************************
            // reactor.core.publisher.LambdaSubscriber.onSubscribe
            // 
            // **********************************************
            s.onSubscribe(new ArraySubscription&lt;&gt;(s, array));
        } //end else
}
</code></pre></div></div>
<h3 id="9lambdasubscriberonsubscribe">(9).LambdaSubscriber.onSubscribe</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// reactor.core.publisher.FluxArray$ArraySubscription
public final void onSubscribe(Subscription s) {
    // s = reactor.core.publisher.FluxArray$ArraySubscription
    // såŒ…è£¹ç€:æ•°ç»„å’ŒLambdaSubscriber
    if (Operators.validate(subscription, s)) { // true
            // è®¢é˜…è€…
            this.subscription = s;
            
            if (subscriptionConsumer != null) { // false
                try {
                    subscriptionConsumer.accept(s);
                } catch (Throwable t) {
                    Exceptions.throwIfFatal(t);
                    s.cancel();
                    onError(t);
                }
            } else {
                // s = FluxArray$ArraySubscription
                s.request(Long.MAX_VALUE);
            } //end else
    } //end if
}
</code></pre></div></div>
<h3 id="10fluxarrayarraysubscription">(10).FluxArray.ArraySubscription</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public void request(long n) {
    // Long.MAX_VALUE
    if (Operators.validate(n)) { // true
            if (Operators.addCap(REQUESTED, this, n) == 0) { // true
                if (n == Long.MAX_VALUE) { // true
                   // invoker fastPath
                    fastPath();
                } else {
                    slowPath(n);
                }
            } //end if
    } //end if
}
</code></pre></div></div>
<h3 id="11fluxarrayarraysubscriptionfastpath">(11).FluxArray.ArraySubscription.fastPath</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>void fastPath() {
    // a = [1, 2]
    final T[] a = array;
    // len = 2
    final int len = a.length;
    // s = reactor.core.publisher.LambdaSubscriber
    final Subscriber&lt;? super T&gt; s = actual;

    // éå†æ•°ç»„
    for (int i = index; i != len; i++) {
        // æ˜¯å¦è®¾ç½®äº†å–æ¶ˆ
        if (cancelled) {
                return;
        }

        // æ•°ç»„ç¬¬Nä¸ªå…ƒç´ 
        T t = a[i];

        
        if (t == null) {
            // ä¸ºç©ºçš„æƒ…å†µä¸‹è°ƒç”¨:onError
            s.onError(new NullPointerException("The " + i + "th array element was null"));
            return;
        }
        // ************************************
        // onNextè°ƒç”¨
        // ************************************
        // æœ€åè°ƒç”¨onNextæ–¹æ³•
        s.onNext(t);
    }// end for
        
    if (cancelled) {
            return;
    } //end if
        
    // æœ€åè°ƒç”¨:onCompelete()æ–¹æ³•    
    s.onComplete();
}
</code></pre></div></div>
<h3 id="12æ€»ç»“">(12).æ€»ç»“</h3>
<ol>
  <li>Flux.just()æ–¹æ³•.<br />
 ä¼šæŠŠä¼ å…¥çš„æ•°æ®å°è£…æˆ:FluxArray(å®ƒå±äºPublisherçš„å­ç±»)</li>
  <li>Flux.subscribe(Consumer c)æ–¹æ³•.<br />
 ä¼šæŠŠConsumerå‡½æ•°å°è£…æˆ:LambdaSubscriber(å®ƒå±äºSubscriberçš„å­ç±»)</li>
  <li>Flux.subscribe(Subscriber) æœ€åå®é™…æ˜¯è¿™æ ·è°ƒç”¨çš„:<br />
 FluxArray.subscribe(LambdaSubscriber s)</li>
  <li>æŠŠæ•°æ®å’Œæ¶ˆè´¹è€…å°è£…æˆ:ArraySubscription(å±äº:Subscriptionçš„å­ç±»)<br />
 LambdaSubscriber
     .onSubscribe(
         new ArraySubscription(LambdaSubscriber,
         [â€œ1â€,â€2â€])
 );<br />
 æ³¨æ„:ArraySubscriptionæŒæœ‰:LambdaSubscriberå’Œæ•°ç»„</li>
  <li>è®¾ç½®ä¸€æ¬¡è®¢é˜…å¤šå°‘<br />
 ArraySubscription.request(Long.MAX_VALUE)</li>
  <li>è¿›è¡Œå¿«é€Ÿæ¶ˆè´¹æˆ–ç¼“å­˜æ¶ˆè´¹<br />
T[] data = [â€œ1â€,â€2â€];
 for(int i=0;i&lt;data.length;i++){
     å¦‚æœæ•°ç»„å…ƒç´ æœ‰ä¸€ä¸ªä¸ºç©º:
     åˆ™è°ƒç”¨:ArraySubscription.onError(â€¦)
     å¦åˆ™è°ƒç”¨:ArraySubscription.onNext(â€¦)
 }
 ArraySubscription.onComplete()</li>
</ol>
:ET